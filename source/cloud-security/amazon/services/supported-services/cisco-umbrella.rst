.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
  :description: Cisco Umbrella is a cloud-based Secure Internet Gateway platform that provides you with multiple levels of defense against internet-based threats. Learn how to configure and monitor it with Wazuh.

Cisco Umbrella
==============

`Cisco Umbrella <https://umbrella.cisco.com/>`_ uses the internet infrastructure to block malicious destinations before a connection is ever established.

Cisco Umbrella configuration
----------------------------

You can find how to configure this service by following the official documentation on `its official website <https://docs.umbrella.com/deployment-umbrella/docs/welcome-to-cisco-umbrella>`_. Furthermore, it is mandatory to configure that the logs generated by this service would be exported to an S3 bucket. You can find how to do that in the `log management section <https://docs.umbrella.com/deployment-umbrella/docs/log-management>`_ of the official documentation.

Policy configuration
--------------------

.. include:: /_templates/cloud/amazon/create_policy.rst
.. include:: /_templates/cloud/amazon/bucket_policies.rst
.. include:: /_templates/cloud/amazon/attach_policy.rst

Wazuh configuration
-------------------

.. note::
  It is required to append the type of logs inside the ``path`` tag as in the next example. `dnslogs`, `proxylogs`, and `iplogs` are currently supported. Each one requires to be defined in an independent ``bucket`` tag.

#. Open the Wazuh configuration file (``/var/ossec/etc/ossec.conf``) and add the following block (this example is for `dnslogs` and `proxylogs`, it is not required to add both):

    .. code-block:: xml

      <wodle name="aws-s3">

        <disabled>no</disabled>
        <interval>10m</interval>
        <run_on_start>yes</run_on_start>
        <skip_on_error>yes</skip_on_error>

        <bucket type="cisco_umbrella">
          <name>cisco-managed-us-east-1</name>
          <path>123456_abcdef0123456789/dnslogs</path>
          <aws_profile>default</aws_profile>
        </bucket>

        <bucket type="cisco_umbrella">
          <name>cisco-managed-us-east-1</name>
          <path>123456_abcdef0123456789/proxylogs</path>
          <aws_profile>default</aws_profile>
        </bucket>

      </wodle>

    .. note::
      Check the :doc:`AWS S3 module </user-manual/reference/ossec-conf/wodle-s3>` reference manual to learn more about each setting.

#. Restart Wazuh in order to apply the changes:

    * If you're configuring a Wazuh manager:

      .. include:: /_templates/common/restart_manager.rst

    * If you're configuring a Wazuh agent:
  
      .. include:: /_templates/common/restart_agent.rst

      