.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
   :description: Wazuh detects if installed applications have an unpatched CVE in the monitored system. Learn more about this in this PoC.

Vulnerability detection
=======================

Wazuh uses the Vulnerability Detection module to identify vulnerabilities in applications and operating systems running on monitored endpoints.

This use case shows how Wazuh detects unpatched Common Vulnerabilities and Exposures (CVEs) in the monitored endpoint.

For more information on this capability, check the :doc:`vulnerability detection </user-manual/capabilities/vulnerability-detection/index>` section of the Wazuh documentation.

Infrastructure
--------------

+-----------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+
| Endpoint                    | Description                                                                                                                                |
+=============================+============================================================================================================================================+
| Red Hat Enterprise Linux 7  | The Wazuh Vulnerability Detection module scans this Linux endpoint for vulnerabilities in the operating system and installed applications. |
+-----------------------------+--------------------------------------------------------------------------------------------------------------------------------------------+

.. note::
   
   Vulnerabilities tagged with the description ``unimportant`` will not appear on the Wazuh dashboard. Visit the `Wazuh CTI <https://cti.wazuh.com/vulnerabilities/cves>`_ page for more information. The :ref:`vuln_det_compatibility_matrix` shows the operating systems officially supported by the Vulnerability Detection module.


Configuration
-------------

The Wazuh Vulnerability Detection module is enabled by default and it generates alerts when new vulnerabilities are detected or when existing vulnerabilities are resolved through package updates, removal, or system upgrades.

Wazuh Server
^^^^^^^^^^^^

Perform the following steps on the Wazuh server to confirm that the Wazuh Vulnerability Detection module is enabled and properly configured.

#. Open the Wazuh configuration ``/var/ossec/etc/ossec.conf`` and check the following settings.

   -  Vulnerability detection is enabled:

      .. code-block:: xml
         :emphasize-lines: 2

         <vulnerability-detection>
            <enabled>yes</enabled>
            <index-status>yes</index-status>
            <feed-update-interval>60m</feed-update-interval>
         </vulnerability-detection>

      .. include:: /_templates/installations/manager/configure_indexer_connection.rst

#. Restart the Wazuh manager if you made changes to the configuration:

   .. code-block:: console

      $ sudo systemctl restart wazuh-manager


Test the configuration
----------------------

.. note::

   The time it takes to detect vulnerabilities depends on the ``<interval>`` value in the Syscollector module, configured in the ``/var/ossec/etc/ossec.conf`` file on the Wazuh agent. For this test, we reduce the Syscollector module interval time from ``1h`` to ``10m``. Refer to  :doc:`System inventory capability configuration </user-manual/capabilities/system-inventory/configuration>` for more information.

#. Install Vim version ``2:7.4.629-8`` which is known to be vulnerable, on the RHEL 7 endpoint. Wait approximately 10 minutes (or the duration set in your Syscollector ``<interval>``) for a new scan to run and the vulnerability to be detected.

#. Remove the Vim package to fix the vulnerability. Wait  10 minutes for the syscollector to run a new scan to confirm the vulnerability has been cleared.

.. _vuln_det_poc_alert_visualize:

Visualize the vulnerabilities
-----------------------------

You can visualize the detected vulnerabilities on the Wazuh dashboard. To see a list of active vulnerabilities, perform the following on the Wazuh dashboard:

-  Go to **Vulnerability Detection** and select **Inventory**.
-  Click + **Add filter**. Then filter by ``package.name``.
-  In the Operator field, select ``is``.
-  Search and select ``vim`` in the Values field.

.. thumbnail:: /images/poc/vulnerabilities-inventory.png
      :title: All active vulnerabilities on Debian. Vulnerable vim package example
      :align: center
      :width: 80%

To see vulnerability alerts from the last system inventory scan, switch to the Events tab. Add filters in the search bar to query vulnerability alerts for Vim.

.. note::

   Not all vulnerabilities added to or removed from the inventory generate alerts. This depends on the event source. See :ref:`vuln_det_alert_generation` for more details.
   
Upon installation of the vulnerable Vim package, the active vulnerability alerts can be seen on the Wazuh dashboard by changing the filter to ``data.vulnerability.package.name: vim AND data.vulnerability.status:Active``

.. thumbnail:: /images/poc/vulnerabilities-events-new-vuln.png
      :title: Detected vulnerabilities on Debian. Vulnerable vim package example
      :align: center
      :width: 80%
      
After removing the vulnerable package from the endpoint, to view the resolved vulnerability alerts, simply change the filter values to ``data.vulnerability.package.name: vim AND data.vulnerability.status:Solved``

.. thumbnail:: /images/poc/vulnerabilities-events-solve-vuln.png
      :title: Solved vulnerabilities on Debian. Vulnerable vim package example
      :align: center
      :width: 80%
