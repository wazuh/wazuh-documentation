.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
   :description: Learn more about offline vulnerability detection in this section of our documentation.

Offline vulnerability detection
===============================

If the Wazuh server does not have direct internet access, it is still possible to keep the Common Vulnerabilities and Exposures (CVE) database up to date. This can be achieved by downloading a snapshot of the threat intelligence repository and making it available within the local network or environment.

.. _offline_threat_intelligence_snapshot:

Threat intelligence snapshot
----------------------------

Wazuh regularly publishes a snapshot of its threat intelligence repository to the Cyber Threat Intelligence (CTI) API. This snapshot includes all CVE documents in a compressed format suitable for offline use.

Retrieving Wazuh threat intelligence snapshot
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

To retrieve the download link and the timestamp of the latest snapshot, run the following command:

.. code-block:: console

   $ curl -s -X GET https://cti.wazuh.com/api/v1/catalog/contexts/vd_1.0.0/consumers/vd_4.8.0 | jq -r '.data | "\(.last_snapshot_link)\n\(.last_snapshot_at)"'

This command queries the CTI API and returns a direct URL to the most recent threat intelligence snapshot file with the date and time it was published.

.. code-block:: none
   :class: output

   https://cti.wazuh.com/store/contexts/vd_1.0.0/consumers/vd_4.8.0/1990927_1748864308.zip
   2025-06-02T11:38:28.279172Z

Where ``2025-06-02T11:38:28.279172Z`` is the time of the last update.

Offline vulnerability detection configuration
---------------------------------------------

Follow the steps below to configure the Vulnerability detection module for offline mode.

#. Download the threat intelligence repository using the URL from querying the CTI API.

   .. code-block:: console

      $ curl https://cti.wazuh.com/store/contexts/vd_1.0.0/consumers/vd_4.8.0/1990927_1748864308.zip -o cves.zip

   .. note::

      Refer to the :ref:`previous section <offline_threat_intelligence_snapshot>` for instructions on retrieving the latest URL for the threat intelligence snapshot

#. Run the command below to update the permissions and ownership of the file cves.zip:

   .. code-block:: console

      # chmod 750 /FILE_PATH_TO_OFFLINE_REPOSITORY/cves.zip
      # chown root:wazuh /FILE_PATH_TO_OFFLINE_REPOSITORY/cves.zip

#. Edit the Wazuh server ``/var/ossec/etc/ossec.conf`` file. Add the offline repository file path in the vulnerability detection block. This configures the Wazuh server to locate it.

   .. code-block:: xml
      :emphasize-lines: 5

      <vulnerability-detection>
         <enabled>yes</enabled>
         <index-status>yes</index-status>
         <feed-update-interval>60m</feed-update-interval>
         <offline-url><FILE_PATH_TO_OFFLINE_REPOSITORY></offline-url>
      </vulnerability-detection>

   Where:

   -  ``<FILE_PATH_TO_OFFLINE_REPOSITORY>`` is the file path to the threat intelligence repository downloaded in the previous step.

#. Restart the Wazuh manager to apply the configuration.

   .. include:: /_templates/installations/manager/restart_wazuh_manager.rst
