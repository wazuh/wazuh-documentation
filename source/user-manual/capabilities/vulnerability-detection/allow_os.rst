.. Copyright (C) 2020 Wazuh, Inc.

.. _vu_allow_os:

Scan vulnerabilities on unsupported systems
===========================================

There are many operating systems derived from others that :doc:`Vulnerability Detector supports<compatibility_matrix>` to
which compatibility of vulnerability feeds could be extended, such as Linux Mint and Oracle Linux. However, those distributions are not scanned by default since there are not pre-defined feeds for them.

For these cases, Vulnerability Detector incorporates the ``allow`` option, which it is possible to indicate which of
the operating systems are compatible with any of the configured feeds.


This guide will explain how to extend compatibility with an unsupported OS.

.. warning::
  This configuration can lead to false positives since each OS vendor handles the package management and security patching by their own.


1. Check the registered name of the agent's operating system.

  It is possible that the registered name of the system does not match the expected one. Therefore, this information can be checked as follows:

  a. Using the Wazuh RESTful API

    .. code-block:: console

      # curl -u foo:bar -k -X GET "https://127.0.0.1:55000/agents/005?pretty"

    Where *005* is the ID of the agent whose operating system we want to check.

    .. code-block:: json
        :class: output

        {
           "error": 0,
           "data": {
              "node_name": "node01",
              "status": "Active",
              "manager": "189b1440bc98",
              "os": {
                 "arch": "x86_64",
                 "major": "7",
                 "minor": "6",
                 "name": "Oracle Linux Server",
                 "platform": "ol",
                 "uname": "Linux |oraclelinux7 |4.14.35-1844.5.3.el7uek.x86_64 |#2 SMP Wed May 8 21:50:52 PDT 2019 |x86_64",
                 "version": "7.6"
              },
              "group": [
                 "default"
              ],
              "dateAdd": "2019-05-21 10:56:42",
              "mergedSum": "ccc51beb7d35c0fd7294b10f70675a1f",
              "name": "oraclelinux7",
              "ip": "10.0.2.15",
              "registerIP": "172.17.0.1",
              "configSum": "ab73af41699f13fdd81903b5f23d8d00",
              "version": "Wazuh v3.9.0",
              "id": "001",
              "lastKeepAlive": "2019-05-21 10:57:40"
           }
        }

    From these values, we need ``data.os.name`` and ``data.os.major``.

  b. Checking manually the database

    .. code-block:: console

      # sqlite3 /var/ossec/queue/db/global.db "SELECT OS_NAME, OS_MAJOR FROM AGENT WHERE ID = 5;"

    Where *5* is the ID of the agent whose operating system we want to check.

    .. code-block:: none
      :class: output

      Oracle Linux Server|7

    These values are the name of the operating system and the major version we will need to configure Vulnerability Detector.

2. Configure Vulnerability Detector to allow the systems.

  It is necessary to include the operating system using the ``allow`` attribute followed by the corresponding feed, following the syntax: "OS name-major version". To include more than one system, just add a list of systems separated by commas.

  For example, if we want to force the compatibility of Ubuntu 16 (Xenial) feed with PopOS 16, and Ubuntu 18 (Bionic) with Linux Mint 19 and Pop OS 18, we will use:

    .. code-block:: xml

      <provider name="canonical">
        <enabled>yes</enabled>
        <os allow="Pop!_OS-16">xenial</os>
        <os allow="Linux Mint-19,Pop!_OS-18">bionic</os>
        <update_interval>1h</update_interval>
      </provider>

  The same for other providers such as Redhat:

    .. code-block:: xml

      <provider name="redhat">
          <enabled>yes</enabled>
          <os allow="Oracle Linux-7">7</os>
          <update_interval>1h</update_interval>
          <update_from_year>2010</update_from_year>
      </provider>

.. note :: Note that we can use a substring of the operating system extracted from the agent in step 1. For this reason, in the
          example ``Oracle Linux`` has been used instead of ``Oracle Linux Server``.
