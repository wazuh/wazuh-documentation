.. _manual_file_integrity:

File integrity monitoring
==========================

File integrity monitoring is the capability that allows us to know if any file has changed. The component responsible for this task is called **syscheck**. This component compares the cryptographic checksum and other attributes of a known good file or Windows registry key against the checksum and attributes of the same after it has been modified.

Syscheck is configured in :ref:`ossec.conf <reference_ossec_conf>`. If you want more information about detailed configuration options, go to :ref:`Syscheck <reference_ossec_syscheck>`. Usually you use the following sections: :ref:`frequency <reference_ossec_syscheck_frequency>`, :ref:`directories <reference_ossec_syscheck_directories>`, :ref:`ignore <reference_ossec_syscheck_ignore>`, :ref:`alert_new_files <reference_ossec_syscheck_alert_new_files>`


.. topic:: Contents

    .. toctree::
        :maxdepth: 1

        fim-examples
        fim-faq

How it works
------------

Syscheck is an essential component of intrusion detection.

.. thumbnail:: ../../images/manual/fim/fim-flow.png
  :title: File integrity monitoring
  :align: center
  :width: 100%

1. Wazuh agent scans the system and sends the checksums and attributes of the monitored files and Windows registry keys to the Wazuh manager. We can configure:

  - **Frequency**: By default, syscheck runs every 6 hours, but this is entirely configurable.
  - **Real-time monitoring**: Wazuh supports real-time file integrity monitoring on servers running Windows or Linux. Note that that the real-time option is only configurable for directories, not for single files.

2. Wazuh manager stores the checksums/attributes and looks for modifications by comparing the new values to the old values. It's possible to configure syscheck to report a diff summary of the actual changes made to text files.

3. An alert is generated if changes are detected on monitored files and/or registry keys.

  It's posible to handle false positives using configuration options like ``ignore``.  You can also create rules that profile files that are to be excluded from FIM alerts.

Alert example, generated by **syscheck**:
::

	** Alert 1460948255.25442: mail  - ossec,syscheck,pci_dss_11.5,
	2016 Apr 17 19:57:35 (ubuntu) 10.0.0.144->syscheck
	Rule: 550 (level 7) -> 'Integrity checksum changed.'
	Integrity checksum changed for: '/test/hello'
	Size changed from '12' to '17'
	Old md5sum was: 'e59ff97941044f85df5297e1c302d260'
	New md5sum is : '7947eba5d9cc58d440fb06912e302949'
	Old sha1sum was: '648a6a6ffffdaa0badb23b8baf90b6168dd16b3a'
	New sha1sum is : '379b74ac9b2d2b09ff6ad7fa876c79f914a755e1'
