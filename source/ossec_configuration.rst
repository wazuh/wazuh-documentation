.. _ossec_configuration:

OSSEC Basic Configuration
===============================

If you made your installation from Sources or DEBs you can continue with the `Agent configuration`_ 
but if you made your install from RPMs repository you will need to make changes in the `Manager configuration`_

Manager configuration
-------------------------

If you made the Manager installation from RPMs need to add the mail configuration, for this
follow the next steps

To access and modify OSSEC's files and directories, you need to switch to the root user::

   $ sudo su
   $ cd /var/ossec/etc

We make a backup from **ossec.conf**::

   $ cp ossec.conf ossec.conf.backup

Then open the original with your favorite text editor::

   $ vi ossec.conf

The mail settings are at the top of the file and need to change **email_to** , **smtp_server** and **email_from** for your own configuration::

   <ossec_config>
     <global>
       <email_notification>yes</email_notification>
       <email_to>jose@xxx.com</email_to>
       <smtp_server>smtp.xxx.com.</smtp_server>
       <email_from>ossecm@ossec.xxx.com.</email_from>
     </global>

After that, only need restart Ossec server::

   $ service ossec-hids restart

Agent configuration
-------------------

If you made the Agentr installation from RPMs need to add the Manager IP Address to the configuration, for this
follow the next steps

To access and modify OSSEC's files and directories, you need to switch to the root user::

   $ sudo su
   $ cd /var/ossec/etc

We make a backup from **ossec.conf**::

   $ cp ossec.conf ossec.conf.backup

Then open the original with your favorite text editor::

   $ vi ossec.conf

You need to add the Manager IP to the agent configuration in **server-ip**::

   <ossec_config>
     <client>
       <server-ip>XXX.XXX.XXX</server-ip>
     </client>


Add Agent to Server
-------------------

On the OSSEC server, start the process of adding the agent.

Excecute **manage_agent**::

   $ /var/ossec/bin/manage_agents

You will then be presented the options shown below. Choose **a** to add an agent::

   ****************************************
   * OSSEC HIDS v2.8 Agent manager.     *
   * The following options are available: *
   ****************************************
      (A)dd an agent (A).
      (E)xtract key for an agent (E).
      (L)ist already added agents (L).
      (R)emove an agent (R).
      (Q)uit.
   Choose your action: A,E,L,R or Q: a

You need to type a name for the agent, a IP Address and an ID
For the ID, you may accept the default by pressing **ENTER**::

   - Adding a new agent (use '\q' to return to the main menu).
     Please provide the following:
      * A name for the new agent: TestAgent
      * The IP Address of the new agent: 111.111.111.111
      * An ID for the new agent[001]:
   Agent information:
      ID:001
      Name:TestAgetn
      IP Address:111.111.111.111

   Confirm adding it?(y/n): 

After that, you'll be returned to the main menu. Now you have to extract the agent's key, which will be echoed to the screen. (It will be different from the one in the example below.)::

   ****************************************
   * OSSEC HIDS v2.8 Agent manager.       *
   * The following options are available: *
   ****************************************
      (A)dd an agent (A).
      (E)xtract key for an agent (E).
      (L)ist already added agents (L).
      (R)emove an agent (R).
      (Q)uit.
   Choose your action: A,E,L,R or Q:e
   
   Available agents: 
   ID: 001, Name: TestAgetn, IP: 111.111.111.111
   Provide the ID of the agent to extract the key (or '\q' to quit): 001

   Agent key information for '001' is: 
   MDAxIFRlc3RBZ2V0biAxMTEuMTExLjExMS4xMTEgY2MxZjA1Y2UxNWQyNzEyNjdlMmE3MTRlODI0MTA1YTgxNTM5ZDliN2U2ZDQ5MWYxYzBkOTU4MjRmNjU3ZmI2Zg==

   ** Press ENTER to return to the main menu.

.. note:: Make sure you copy it, because you'll have to enter it for the agent.

Import The Key From Server to Agent
-----------------------------------

This section has to be completed on the agent, and it involves importing (copying) the agent's key extracted on the server and pasting it on the agent's terminal. To start, execute by root the next command::

   $ /var/ossec/bin/manage_agents

You'll be presented with these options::

   ****************************************
   * OSSEC HIDS v2.8 Agent manager.       *
   * The following options are available: *
   ****************************************
      (I)mport key from the server (I).
      (Q)uit.
   Choose your action: I or Q: i

After typing the correct option, follow the directions to copy and paste the key generated from the server::

   * Provide the Key generated by the server.
   * The best approach is to cut and paste it.
   *** OBS: Do not include spaces or new lines.

   Paste it here (or '\q' to quit): MDAxIFRlc3RBZ2V0biAxMTEuMTExLjExMS4xMTEgY2MxZjA1Y2UxNWQyNzEyNjdlMmE3MTRlODI0MTA1YTgxNTM5ZDliN2U2ZDQ5MWYxYzBkOTU4MjRmNjU3ZmI2Zg==

   Agent information:
      ID:001
      Name:TestAgetn
      IP Address:111.111.111.111

   Confirm adding it?(y/n): y

Now your Ossec Agent is finished and working properly.

